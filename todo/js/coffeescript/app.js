// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var app;
    app = {};
    app.Todo = Backbone.Model.extend({
      defaults: {
        title: "",
        completed: false
      }
    });
    app.TodoList = Backbone.Collection.extend({
      model: app.Todo,
      localStorage: new Backbone.LocalStorage("backbone-todo")
    });
    app.todoList = new app.TodoList();
    app.TodoView = Backbone.View.extend({
      tagName: "li",
      className: "list-group-item",
      template: _.template($("#item-template").html()),
      initialize: function() {
        this.render();
        return this.model.on("change", this.render, this);
      },
      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        return this.input = this.$(".edit");
      },
      events: {
        "dblclick .title": "edit",
        "blur     .edit": "close",
        "keypress .edit": "updateOnEnter"
      },
      edit: function() {
        this.$el.addClass("editing");
        return this.input.focus();
      },
      close: function() {
        var value;
        value = this.input.val().trim();
        if (value) {
          this.model.save({
            title: value
          });
        } else {
          this.input.val(this.model.title);
        }
        return this.$el.removeClass("editing");
      },
      updateOnEnter: function(e) {
        if (e.which === 13) {
          return this.close();
        }
      }
    });
    app.AppView = Backbone.View.extend({
      el: "#todoapp",
      initialize: function() {
        this.input = this.$("#new-todo");
        this.ul = this.$("#todo-list");
        app.todoList.on("add", this.addOne, this);
        return app.todoList.fetch();
      },
      addOne: function(todo) {
        var view;
        view = new app.TodoView({
          model: todo
        });
        return this.ul.append(view.$el);
      },
      events: {
        "keypress #new-todo": "createTodoOnEnter"
      },
      createTodoOnEnter: function(e) {
        if (e.which !== 13 || this.input.val().trim() === "") {
          return;
        }
        app.todoList.create(this.newAttributes());
        return this.input.val("");
      },
      newAttributes: function() {
        return {
          title: this.input.val(),
          completed: false
        };
      }
    });
    return app.appView = new app.AppView();
  });

}).call(this);
